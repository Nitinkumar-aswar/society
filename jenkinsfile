pipeline {
    agent any
    
    environment {
        // Define environment variables if needed
        REACT_APP_DIR = 'frontend'
        PYTHON_APP_DIR = 'backend'
        AWS_REGION = 'us-west-2'
    }
    
    stages {
        stage('Checkout Code') {
            steps {
                // Checkout the code from your repository
                git 'https://github.com/your-repo.git'
            }
        }

        stage('Install Dependencies') {
            steps {
                // Install dependencies for React
                dir(REACT_APP_DIR) {
                    sh 'npm install'
                }
                
                // Install dependencies for Python (if using a virtual environment)
                dir(PYTHON_APP_DIR) {
                    sh 'pip install -r requirements.txt'
                }
            }
        }

        stage('Build') {
            steps {
                // Build React App
                dir(REACT_APP_DIR) {
                    sh 'npm run build'
                }
            }
        }

        stage('Test') {
            steps {
                // Run tests for React and Python
                dir(REACT_APP_DIR) {
                    sh 'npm run test'
                }
                dir(PYTHON_APP_DIR) {
                    sh 'pytest'  // Assuming you're using pytest for Python testing
                }
            }
        }

        stage('Deploy to AWS') {
            steps {
                // Deploy to AWS using AWS CLI
                sh """
                aws s3 sync ${REACT_APP_DIR}/build s3://your-react-app-bucket --region ${AWS_REGION}
                aws ecs update-service --cluster your-cluster-name --service your-service-name --force-new-deployment --region ${AWS_REGION}
                """
            }
        }
    }
}
